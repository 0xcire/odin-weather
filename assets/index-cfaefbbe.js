(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}})();class p{constructor(){this.options={enableHighAccuracy:!1,timeout:1e4,maximumAge:0},this.coords={latitude:"",longitude:""}}locationExists(){return!!navigator.geolocation}getCoordinates(){return this.coords}storeLocation(t){this.coords.latitude=t.coords.latitude,this.coords.longitude=t.coords.longitude}handleError(t){console.log(t.message)}getCurrentLocation(){return new Promise((t,a)=>{const i=o=>t(o),e=o=>a(o);navigator.geolocation.getCurrentPosition(i,e,this.options)})}}const l={WEATHER_KEY:"dc3734ae2b755e7d9adcfc2c300aaf05",GIF_KEY:"4nqbNbqsnFBeAYgKFwnOCFsuatcIsPag"};class f{constructor(){this.key=l.WEATHER_KEY,this.name="",this.coordinates={latitude:"",longitude:""}}async getCity({latitude:t,longitude:a}){try{const i=await fetch(`http://api.openweathermap.org/geo/1.0/reverse?lat=${t}&lon=${a}&limit=${1}&appid=${this.key}`);if(!i.ok)throw new Error("bad response");const e=await i.json(),o=`${e[0].name}, ${e[0].state}`;return this.name=o,this.name}catch(i){console.log(i)}}async getCoordinates(t){let a;a=`http://api.openweathermap.org/geo/1.0/direct?q=${t}&limit=${1}&appid=${this.key}`;try{const i=await fetch(a);if(!i.ok)throw new Error("bad response");const e=await i.json();return this.coordinates.latitude=e[0].lat,this.coordinates.longitude=e[0].lon,this.name=`${e[0].name}, ${e[0].country}`,this.coordinates}catch(i){console.log(i)}}}class y{constructor(){this.key=l.WEATHER_KEY,this.endpoint="https://api.openweathermap.org/data/2.5/",this.options={units:"imperial"},this.data={}}formatSunset(t){const i=this.formatUnix(t.sys.sunset).split(":");let e=Number(i[0]);const o=i[1];return e>12?e=e-12:e===0&&(e=12),e=e.toString(),`${e}:${o}`}formatUnix(t){const a=new Date(t*1e3),i=a.getHours().toString();let e=a.getMinutes().toString();return e<10?e="0"+e:e=e,`${i}:${e}`}createQuery(){return(this.data.description+" weather").replace(/\s/g,"+")}async getCurrentWeather({latitude:t,longitude:a}){const i=`${this.endpoint}weather?lat=${t}&lon=${a}&units=${this.options.units}&appid=${this.key}`;try{const e=await fetch(i);if(!e.ok)throw new Error("bad response");const o=await e.json(),c={coordinates:{latitude:o.coord.lat,longitude:o.coord.lon},iconURL:`http://openweathermap.org/img/wn/${o.weather[0].icon}@2x.png`,degrees:o.main.temp,description:o.weather[0].description,feelsLike:o.main.feels_like,humidity:o.main.humidity,sunrise:this.formatUnix(o.sys.sunrise),sunset:this.formatSunset(o),wind:{deg:o.wind.deg,speed:o.wind.speed}};return this.data=c,this.data}catch(e){console.log(e)}}}class w{constructor(){this.key=l.GIF_KEY,this.endpoint="https://api.giphy.com/v1/gifs/search",this.options={limit:1,offset:0,rating:"g",lang:"en"},this.url=""}async getRelatedGif(t){const a=`${this.endpoint}?api_key=${this.key}&q=${t}&limit=${this.options.limit}&offset=${this.options.offset}&rating=${this.options.rating}&lang=${this.options.lang}`,e=await(await fetch(a)).json();return this.url=e.data[0].images.original.url,this.url}}const r={app:document.querySelector("#app"),container:document.querySelector(".container"),searchForm:document.querySelector("#search-form"),weather:document.querySelector("#weather"),location:document.querySelector(".city"),pin:document.querySelector(".fa-location-pin"),search:document.querySelector(".search"),error:document.querySelector(".error"),icon:document.querySelector(".icon"),degrees:document.querySelector(".degrees"),description:document.querySelector(".weather-description"),feelsLike:document.querySelector(".feels-like"),humidity:document.querySelector(".humidity"),sunrise:document.querySelector(".sunrise"),sunset:document.querySelector(".sunset"),windDirection:document.querySelector(".wind-direction"),windSpeed:document.querySelector(".wind-speed"),gifBG:document.querySelector(".background-gif")},h=n=>{r.icon.src=`${n.iconURL}`,r.icon.alt=`${n.description}-icon`,r.degrees.innerHTML=`${Math.round(n.degrees)}&#176;F`,r.description.textContent=n.description,r.feelsLike.innerHTML=`Feels like: ${Math.round(n.feelsLike)}&#176;F`,r.humidity.textContent=`Humidity: ${n.humidity}%`,r.sunrise.textContent=`Sunrise at ${n.sunrise} AM`,r.sunset.textContent=`Sunset at ${n.sunset} PM`,r.windDirection.classList.remove("hidden");const t=11.25+n.wind.deg;r.windDirection.style.transform=`rotate(${t}deg)`,r.windSpeed.textContent=`${n.wind.speed} mph`},g=(n,t)=>{n.style.background=`linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)),
  url("${t}")`,n.style.backgroundSize="cover"},d=n=>{n.style.animationPlayState="paused",n.style.animation="none"},m=(n,t)=>{n.textContent=t},u=n=>{n.classList.remove("hidden")},s={geolocation:new p,geocode:new f,weather:new y,gif:new w};r.searchForm.addEventListener("submit",async function(n){n.preventDefault();const t=new FormData(this).get("query");await s.geocode.getCoordinates(t),await s.weather.getCurrentWeather(s.geocode.coordinates);const a=s.weather.createQuery();await s.gif.getRelatedGif(a),r.pin.style.color="#f4f4f4",r.container.style.color="#f4f4f4",m(r.location,s.geocode.name),h(s.weather.data),g(r.gifBG,s.gif.url),this.reset()});document.addEventListener("DOMContentLoaded",async()=>{if(s.geolocation.locationExists())try{const n=await s.geolocation.getCurrentLocation();s.geolocation.storeLocation(n),await s.geocode.getCity(s.geolocation.coords),await s.weather.getCurrentWeather(s.geolocation.coords);const t=s.weather.createQuery();await s.gif.getRelatedGif(t),d(r.pin),r.pin.style.color="#f4f4f4",m(r.location,s.geocode.name),u(r.search),h(s.weather.data),g(r.gifBG,s.gif.url)}catch(n){console.log(n),d(r.pin),console.log("rendering base home screen"),r.container.style.color="#000",u(r.search)}else console.log("geolocation does not exist. rendering home screen"),r.container.style.color="#000",d(r.pin),u(r.search)});
